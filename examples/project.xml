<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.
// heart&lt;-&gt;pacemaker interface
broadcast chan Apace, Vpace, Asignal, Vsignal, AlarmH, AlarmL, NoAlarm;

const int Sleep_LRI = (60 * 1000) / 30;
const int Sleep_URI = (60 * 1000) / 60;
const int Normal_LRI = (60 * 1000) / 40;
const int Normal_URI = (60 * 1000) / 100;
const int Sports_LRI = (60 * 1000) / 100;
const int Sports_URI = (60 * 1000) / 175;
const int Manual_LRI = (60 * 1000) / 30;
const int Manual_URI = (60 * 1000) / 175;

const int Low_AVI = 30;
const int High_AVI = 100;
const int Max_AVIExt = 50; // dynamic AVI
const int AVIExt_Step = 5;
const int Low_VRP = 150;
const int High_VRP = 500;
const int Low_PVARP = 150;
const int High_PVARP = 500;
const int Low_PVAB = 10;
const int High_PVAB = 60;
const int Low_MSTI = 300;
const int High_MSTI = 10000;
const int A_minwait = 500;
const int A_maxwait = 1000;
const int V_minwait = 500;
const int V_maxwait = 1000;

typedef int[0,1] tstkeyAV; 

// heart
clock clkheart;

int[0,2] heartmode = 0;
urgent broadcast chan HMmodechange, testHM_random, testHM_manual, testHM_test, testHM_gen[tstkeyAV];
	
// pacemaker - AA lower rate timing mode
urgent broadcast chan Asense, Vsense;
urgent broadcast chan PMmodechange, testPM_normal, testPM_sleep, testPM_sports, testPM_manual, testPM_gen[tstkeyAV];
int[0,1] pmmode = 0;
clock clk_aa, clk_pvarp;
int[Low_AVI, High_AVI] cur_avi = Low_AVI;
int[0, Max_AVIExt] cur_avi_ext = 0;
int[Low_PVARP, High_PVARP] cur_pvarp = Low_PVARP;
int[Low_PVAB, High_PVAB] cur_pvab = Low_PVAB;
int[Low_VRP, High_VRP] cur_vrp = Low_VRP;
int[0, Manual_LRI] cur_uri = Normal_URI;
int[0, Manual_LRI] cur_lri = Normal_LRI;
int[Low_MSTI, High_MSTI] cur_msti = High_MSTI;
</declaration><template><name>HM_ModeSwitch</name><location id="id0" x="-480" y="8"><committed/></location><location id="id1" x="-480" y="-160"><committed/></location><location id="id2" x="-600" y="192"><committed/></location><location id="id3" x="-344" y="192"><committed/></location><location id="id4" x="-480" y="80"><name x="-544" y="80">Manual</name></location><location id="id5" x="-480" y="-64"><name x="-472" y="-96">Init</name></location><init ref="id5"/><transition><source ref="id0"/><target ref="id4"/><label kind="synchronisation" x="-540" y="29">HMmodechange!</label></transition><transition><source ref="id1"/><target ref="id5"/><label kind="synchronisation" x="-528" y="-136">HMmodechange!</label></transition><transition><source ref="id2"/><target ref="id4"/><label kind="synchronisation" x="-560" y="200">Vsignal!</label><nail x="-504" y="192"/></transition><transition><source ref="id4"/><target ref="id2"/><label kind="synchronisation" x="-672" y="152">testHM_gen[0]?</label></transition><transition><source ref="id3"/><target ref="id4"/><label kind="synchronisation" x="-456" y="200">Asignal!</label><nail x="-440" y="192"/></transition><transition><source ref="id4"/><target ref="id3"/><label kind="synchronisation" x="-392" y="128">testHM_gen[1]?</label></transition><transition><source ref="id4"/><target ref="id1"/><label kind="synchronisation" x="-816" y="-144">testHM_test?</label><label kind="assignment" x="-824" y="-120">heartmode = 0</label><nail x="-632" y="80"/><nail x="-744" y="-176"/><nail x="-744" y="-224"/><nail x="-488" y="-224"/></transition><transition><source ref="id4"/><target ref="id1"/><label kind="synchronisation" x="-664" y="-72">testHM_random?</label><label kind="assignment" x="-648" y="-56">heartmode = 0</label><nail x="-512" y="64"/><nail x="-616" y="64"/><nail x="-720" y="-176"/><nail x="-720" y="-208"/><nail x="-512" y="-208"/></transition><transition><source ref="id5"/><target ref="id1"/><label kind="synchronisation" x="-632" y="-168">testHM_test?</label><label kind="assignment" x="-624" y="-144">heartmode = 1</label><nail x="-640" y="-192"/><nail x="-544" y="-192"/></transition><transition><source ref="id5"/><target ref="id1"/><label kind="synchronisation" x="-368" y="-136">testHM_random?</label><label kind="assignment" x="-360" y="-120">heartmode = 0</label><nail x="-464" y="-72"/><nail x="-320" y="-192"/><nail x="-416" y="-192"/></transition><transition><source ref="id5"/><target ref="id0"/><label kind="synchronisation" x="-472" y="-56">testHM_manual?</label><label kind="assignment" x="-472" y="-40">heartmode = 2</label><nail x="-480" y="-24"/></transition></template><template><name x="8" y="8">HM_Asignal</name><declaration>// Place local declarations here.
</declaration><location id="id6" x="136" y="-112"><name x="152" y="-120">Disabled</name></location><location id="id7" x="-24" y="-112"><name x="-32" y="-144">RHM</name><label kind="invariant" x="-88" y="-72">clkheart &lt;= A_maxwait</label></location><init ref="id7"/><transition><source ref="id6"/><target ref="id7"/><label kind="guard" x="80" y="-216">heartmode == 0</label><label kind="synchronisation" x="80" y="-232">HMmodechange?</label><label kind="assignment" x="80" y="-200">clkheart = 0</label><nail x="136" y="-160"/></transition><transition><source ref="id7"/><target ref="id6"/><label kind="guard" x="80" y="-48">heartmode != 0</label><label kind="synchronisation" x="80" y="-64">HMmodechange?</label><nail x="136" y="-64"/></transition><transition><source ref="id7"/><target ref="id7"/><label kind="guard" x="-312" y="-168">clkheart &gt;= A_minwait</label><label kind="synchronisation" x="-312" y="-152">Asignal!</label><label kind="assignment" x="-312" y="-128">clkheart = 0</label><nail x="-160" y="-40"/><nail x="-160" y="-192"/></transition></template><template><name>HM_Apace</name><location id="id8" x="0" y="0"><name x="-10" y="-30">AIdle</name></location><init ref="id8"/><transition><source ref="id8"/><target ref="id8"/><label kind="synchronisation" x="144" y="-32">Apace?</label><label kind="assignment" x="144" y="-16">clkheart = 0</label><nail x="128" y="-96"/><nail x="128" y="96"/></transition></template><template><name x="8" y="8">HM_Vsignal</name><declaration>// Place local declarations here.
</declaration><location id="id9" x="144" y="-112"><name x="134" y="-142">Disabled</name></location><location id="id10" x="-24" y="-112"><name x="-32" y="-144">RHM</name><label kind="invariant" x="-88" y="-72">clkheart &lt;= V_maxwait</label></location><init ref="id10"/><transition><source ref="id10"/><target ref="id9"/><label kind="guard" x="96" y="-32">heartmode != 0</label><label kind="synchronisation" x="80" y="-8">HMmodechange?</label><nail x="144" y="-48"/></transition><transition><source ref="id9"/><target ref="id10"/><label kind="guard" x="88" y="-216">heartmode == 0</label><label kind="synchronisation" x="88" y="-232">HMmodechange?</label><label kind="assignment" x="88" y="-200">clkheart = 0</label><nail x="144" y="-168"/></transition><transition><source ref="id10"/><target ref="id10"/><label kind="guard" x="-312" y="-168">clkheart &gt;= V_minwait</label><label kind="synchronisation" x="-312" y="-152">Vsignal!</label><label kind="assignment" x="-312" y="-128">clkheart = 0</label><nail x="-160" y="-40"/><nail x="-160" y="-192"/></transition></template><template><name>HM_Vpace</name><location id="id11" x="0" y="0"><name x="-10" y="-30">VIdle</name></location><init ref="id11"/><transition><source ref="id11"/><target ref="id11"/><label kind="synchronisation" x="144" y="-32">Vpace?</label><label kind="assignment" x="144" y="-16">clkheart = 0</label><nail x="128" y="-96"/><nail x="128" y="96"/></transition></template><template><name>HM_Leds_Apace</name><location id="id12" x="112" y="0"><name x="102" y="-30">On</name><committed/></location><location id="id13" x="0" y="0"><name x="-10" y="-30">Off</name></location><init ref="id13"/><transition><source ref="id12"/><target ref="id13"/><nail x="56" y="48"/></transition><transition><source ref="id13"/><target ref="id12"/><label kind="synchronisation" x="24" y="-80">Apace?</label><nail x="56" y="-56"/></transition></template><template><name>HM_Leds_Asignal</name><location id="id14" x="112" y="0"><name x="102" y="-30">On</name><committed/></location><location id="id15" x="0" y="0"><name x="-10" y="-30">Off</name></location><init ref="id15"/><transition><source ref="id14"/><target ref="id15"/><nail x="56" y="48"/></transition><transition><source ref="id15"/><target ref="id14"/><label kind="synchronisation" x="24" y="-80">Asignal?</label><nail x="56" y="-56"/></transition></template><template><name>HM_Leds_Vpace</name><location id="id16" x="112" y="0"><name x="102" y="-30">On</name><committed/></location><location id="id17" x="0" y="0"><name x="-10" y="-30">Off</name></location><init ref="id17"/><transition><source ref="id16"/><target ref="id17"/><nail x="56" y="48"/></transition><transition><source ref="id17"/><target ref="id16"/><label kind="synchronisation" x="24" y="-80">Vpace?</label><nail x="56" y="-56"/></transition></template><template><name>HM_Leds_Vsignal</name><location id="id18" x="112" y="0"><name x="102" y="-30">On</name><committed/></location><location id="id19" x="0" y="0"><name x="-10" y="-30">Off</name></location><init ref="id19"/><transition><source ref="id18"/><target ref="id19"/><nail x="56" y="48"/></transition><transition><source ref="id19"/><target ref="id18"/><label kind="synchronisation" x="24" y="-80">Vsignal?</label><nail x="56" y="-56"/></transition></template><template><name>HM_DisplayAndAlarm</name><declaration>int aa_count = 0;
int aa_rate = 0;
clock t;</declaration><location id="id20" x="-976" y="-16"><name x="-986" y="-46">ShowRate</name><committed/></location><location id="id21" x="-368" y="-16"><name x="-378" y="-46">Incr</name><committed/></location><location id="id22" x="-496" y="-16"><name x="-472" y="-16">Init</name><label kind="invariant" x="-496" y="0">t &lt;= cur_msti</label></location><init ref="id22"/><transition><source ref="id20"/><target ref="id22"/><label kind="guard" x="-784" y="8">(aa_rate &gt; (60000 / cur_uri))</label><label kind="synchronisation" x="-784" y="-8">AlarmH!</label><nail x="-832" y="32"/><nail x="-584" y="32"/></transition><transition><source ref="id20"/><target ref="id22"/><label kind="guard" x="-912" y="-40">(aa_rate &gt;= (60000 / cur_lri)) &amp;&amp; (aa_rate &lt;= (60000 / cur_uri))</label><label kind="synchronisation" x="-784" y="-72">NoAlarm!</label><nail x="-792" y="-16"/></transition><transition><source ref="id20"/><target ref="id22"/><label kind="guard" x="-792" y="64">(aa_rate &lt; (60000 / cur_lri))</label><label kind="synchronisation" x="-744" y="80">AlarmL!</label><nail x="-928" y="96"/><nail x="-576" y="96"/></transition><transition><source ref="id20"/><target ref="id22"/></transition><transition><source ref="id22"/><target ref="id20"/><label kind="guard" x="-792" y="-168">t &gt;= cur_msti</label><label kind="assignment" x="-800" y="-144">aa_rate = ((aa_count * 60000) / cur_msti),
aa_count = 0,
t = 0</label><nail x="-576" y="-96"/><nail x="-736" y="-96"/><nail x="-832" y="-96"/><nail x="-896" y="-56"/></transition><transition><source ref="id21"/><target ref="id22"/><label kind="assignment" x="-464" y="136">aa_count = aa_count + 1</label><nail x="-256" y="-16"/><nail x="-256" y="128"/><nail x="-512" y="128"/><nail x="-512" y="0"/></transition><transition><source ref="id22"/><target ref="id21"/><label kind="synchronisation" x="-448" y="-112">Apace?</label><nail x="-464" y="-88"/><nail x="-392" y="-88"/></transition><transition><source ref="id22"/><target ref="id21"/><label kind="synchronisation" x="-448" y="64">Asignal?</label><nail x="-488" y="-8"/><nail x="-464" y="56"/><nail x="-392" y="56"/></transition></template><template><name>PM_ModeSwitch</name><location id="id23" x="-304" y="-336"><committed/></location><location id="id24" x="-480" y="-336"><committed/></location><location id="id25" x="-656" y="-336"><committed/></location><location id="id26" x="-480" y="8"><committed/></location><location id="id27" x="-480" y="-216"><committed/></location><location id="id28" x="-600" y="192"><committed/></location><location id="id29" x="-344" y="192"><committed/></location><location id="id30" x="-480" y="80"><name x="-544" y="80">Manual</name></location><location id="id31" x="-480" y="-104"><name x="-472" y="-136">Init</name></location><init ref="id31"/><transition><source ref="id31"/><target ref="id25"/><label kind="synchronisation" x="-640" y="-96">testPM_sports?</label><nail x="-656" y="-104"/></transition><transition><source ref="id31"/><target ref="id24"/><label kind="synchronisation" x="-192" y="-200">testPM_sleep?</label><nail x="-96" y="-104"/><nail x="-96" y="-424"/><nail x="-480" y="-424"/></transition><transition><source ref="id31"/><target ref="id23"/><label kind="synchronisation" x="-232" y="-176">testPM_normal?</label><nail x="-128" y="-104"/><nail x="-128" y="-400"/><nail x="-304" y="-400"/><nail x="-304" y="-352"/></transition><transition><source ref="id30"/><target ref="id23"/><label kind="synchronisation" x="-872" y="-200">testPM_normal?</label><nail x="-496" y="80"/><nail x="-880" y="80"/><nail x="-880" y="-400"/><nail x="-304" y="-400"/></transition><transition><source ref="id23"/><target ref="id27"/><label kind="assignment" x="-288" y="-336">cur_uri = Normal_URI,
cur_lri = Normal_LRI</label><nail x="-336" y="-256"/></transition><transition><source ref="id26"/><target ref="id30"/><label kind="synchronisation" x="-472" y="24">PMmodechange!</label><label kind="assignment" x="-472" y="40">pmmode = 1</label></transition><transition><source ref="id27"/><target ref="id31"/><label kind="synchronisation" x="-472" y="-192">PMmodechange!</label><label kind="assignment" x="-464" y="-176">pmmode = 0</label></transition><transition><source ref="id28"/><target ref="id30"/><label kind="synchronisation" x="-560" y="200">Vpace!</label><nail x="-504" y="192"/></transition><transition><source ref="id30"/><target ref="id28"/><label kind="synchronisation" x="-672" y="152">testPM_gen[0]?</label></transition><transition><source ref="id29"/><target ref="id30"/><label kind="synchronisation" x="-456" y="200">Apace!</label><nail x="-440" y="192"/></transition><transition><source ref="id30"/><target ref="id29"/><label kind="synchronisation" x="-392" y="128">testPM_gen[1]?</label></transition><transition><source ref="id30"/><target ref="id24"/><label kind="synchronisation" x="-832" y="-176">testPM_sleep?</label><nail x="-840" y="80"/><nail x="-840" y="-368"/><nail x="-480" y="-368"/></transition><transition><source ref="id30"/><target ref="id25"/><label kind="synchronisation" x="-800" y="-152">testPM_sports?</label><nail x="-808" y="80"/><nail x="-808" y="-88"/><nail x="-808" y="-336"/></transition><transition><source ref="id24"/><target ref="id27"/><label kind="assignment" x="-536" y="-320">cur_uri = Sleep_URI,
cur_lri = Sleep_LRI</label><nail x="-480" y="-264"/></transition><transition><source ref="id25"/><target ref="id27"/><label kind="assignment" x="-792" y="-336">cur_uri = Sports_URI,
cur_lri = Sports_LRI</label><nail x="-624" y="-256"/></transition><transition><source ref="id31"/><target ref="id26"/><label kind="synchronisation" x="-472" y="-56">testPM_manual?</label><nail x="-480" y="-24"/></transition></template><template><name>PM_Sensor_A</name><location id="id32" x="-624" y="32"><name x="-634" y="2">Aevent</name><committed/></location><location id="id33" x="184" y="-16"><name x="144" y="0">Wait_URI</name><label kind="invariant" x="120" y="24">clk_aa &lt;= cur_uri</label></location><location id="id34" x="-16" y="-16"><name x="-56" y="0">Wait_PVARP</name><label kind="invariant" x="-80" y="24">clk_pvarp &lt;= cur_pvarp</label></location><location id="id35" x="-144" y="-16"><name x="-160" y="-56">VEvent</name><committed/></location><location id="id36" x="-368" y="-16"><name x="-408" y="0">WaitAVI</name></location><location id="id37" x="-512" y="-16"><name x="-512" y="8">ResetClk</name><committed/></location><location id="id38" x="-720" y="-16"><name x="-752" y="0">Await</name></location><init ref="id38"/><transition><source ref="id32"/><target ref="id37"/><label kind="synchronisation" x="-592" y="40">Asense!</label><nail x="-576" y="32"/><nail x="-560" y="24"/></transition><transition><source ref="id38"/><target ref="id32"/><label kind="synchronisation" x="-704" y="40">Asignal?</label><nail x="-680" y="32"/></transition><transition><source ref="id33"/><target ref="id38"/><label kind="guard" x="-344" y="-152">clk_aa &gt;= cur_uri</label><nail x="200" y="-48"/><nail x="200" y="-104"/><nail x="184" y="-120"/><nail x="-752" y="-120"/><nail x="-768" y="-96"/><nail x="-768" y="-48"/></transition><transition><source ref="id34"/><target ref="id33"/><label kind="guard" x="8" y="-46">clk_pvarp &gt;= cur_pvarp</label></transition><transition><source ref="id35"/><target ref="id34"/><label kind="assignment" x="-128" y="-40">clk_pvarp = 0</label></transition><transition><source ref="id36"/><target ref="id35"/><label kind="synchronisation" x="-280" y="40">Vsense?</label><nail x="-320" y="32"/><nail x="-192" y="32"/></transition><transition><source ref="id36"/><target ref="id35"/><label kind="synchronisation" x="-272" y="-88">Vpace?</label><nail x="-312" y="-64"/><nail x="-192" y="-64"/></transition><transition><source ref="id37"/><target ref="id36"/><label kind="assignment" x="-480" y="-40">clk_aa = 0</label></transition><transition><source ref="id38"/><target ref="id37"/><label kind="synchronisation" x="-640" y="-88">Apace?</label><nail x="-672" y="-64"/><nail x="-576" y="-64"/></transition></template><template><name>PM_Sensor_V</name><declaration>clock clkt;</declaration><location id="id39" x="-904" y="-48"><name x="-952" y="-56">PVC</name><committed/></location><location id="id40" x="-304" y="-112"><committed/></location><location id="id41" x="48" y="-48"><name x="64" y="-64">DoneVRP</name><committed/></location><location id="id42" x="-96" y="-48"><name x="-120" y="-32">WaitVRP</name><label kind="invariant" x="-128" y="-16">clkt &lt;= cur_vrp</label></location><location id="id43" x="-208" y="-48"><name x="-272" y="-56">VEvent</name><committed/></location><location id="id44" x="-400" y="-48"><name x="-384" y="-56">WaitVEvent</name></location><location id="id45" x="-544" y="-48"><name x="-576" y="-32">Wait_PVAB</name><label kind="invariant" x="-592" y="-8">clkt &lt;= cur_pvab</label></location><location id="id46" x="-672" y="-48"><name x="-674" y="-30">Init_PVAB</name><committed/></location><location id="id47" x="-800" y="-48"><name x="-776" y="-56">Init</name></location><init ref="id47"/><transition><source ref="id39"/><target ref="id47"/><label kind="synchronisation" x="-880" y="-136">Vsense!</label><nail x="-880" y="-112"/><nail x="-832" y="-112"/></transition><transition><source ref="id47"/><target ref="id39"/><label kind="synchronisation" x="-872" y="24">Vsignal?</label><nail x="-832" y="16"/><nail x="-872" y="16"/></transition><transition><source ref="id40"/><target ref="id43"/><label kind="synchronisation" x="-288" y="-136">Vsense!</label><nail x="-256" y="-112"/></transition><transition><source ref="id44"/><target ref="id40"/><label kind="synchronisation" x="-376" y="-136">Vsignal?</label><nail x="-344" y="-112"/></transition><transition><source ref="id41"/><target ref="id47"/><nail x="48" y="-144"/><nail x="8" y="-168"/><nail x="-768" y="-168"/><nail x="-800" y="-136"/></transition><transition><source ref="id42"/><target ref="id41"/><label kind="guard" x="-80" y="-72">clkt &gt;= cur_vrp</label><nail x="-80" y="-48"/></transition><transition><source ref="id43"/><target ref="id42"/><label kind="assignment" x="-184" y="-72">clkt = 0</label></transition><transition><source ref="id44"/><target ref="id43"/><label kind="synchronisation" x="-320" y="24">Vpace?</label><nail x="-344" y="16"/><nail x="-264" y="16"/></transition><transition><source ref="id45"/><target ref="id44"/><label kind="guard" x="-528" y="-72">clkt &gt;= cur_pvab</label></transition><transition><source ref="id46"/><target ref="id45"/><label kind="assignment" x="-640" y="-72">clkt = 0</label></transition><transition><source ref="id47"/><target ref="id46"/><label kind="synchronisation" x="-752" y="16">Apace?</label><nail x="-768" y="16"/><nail x="-704" y="16"/></transition><transition><source ref="id47"/><target ref="id46"/><label kind="synchronisation" x="-760" y="-136">Asense?</label><nail x="-768" y="-112"/><nail x="-704" y="-112"/></transition></template><template><name>PM_Pacer_AA</name><location id="id48" x="-320" y="-480"><name x="-344" y="-512">PaceV</name><committed/></location><location id="id49" x="-464" y="-320" color="#00ff00"><name x="-504" y="-296">PMManualMode</name></location><location id="id50" x="272" y="-560"><name x="280" y="-552">Adone</name><committed/></location><location id="id51" x="-16" y="-560"><name x="-32" y="-544">PVC</name><label kind="invariant" x="-88" y="-528">clk_aa &lt;= (cur_lri - cur_avi)</label></location><location id="id52" x="176" y="-560"><name x="176" y="-544">PaceA</name><committed/></location><location id="id53" x="-176" y="-560"><name x="-176" y="-544">Vevent</name><label kind="invariant" x="-216" y="-528">clk_aa &lt;= cur_lri</label></location><location id="id54" x="-464" y="-560"><name x="-432" y="-584">AVI_Wait</name><label kind="invariant" x="-432" y="-560">clk_aa &lt;= (cur_avi + cur_avi_ext)</label></location><init ref="id54"/><transition><source ref="id48"/><target ref="id53"/><label kind="synchronisation" x="-288" y="-504">Vpace!</label><nail x="-304" y="-480"/><nail x="-248" y="-480"/></transition><transition><source ref="id50"/><target ref="id49"/><label kind="guard" x="8" y="-288">pmmode == 1</label><label kind="synchronisation" x="8" y="-312">PMmodechange?</label><nail x="216" y="-320"/></transition><transition><source ref="id52"/><target ref="id49"/><label kind="guard" x="-112" y="-296">pmmode == 1</label><label kind="synchronisation" x="-112" y="-312">PMmodechange?</label><nail x="112" y="-336"/></transition><transition><source ref="id51"/><target ref="id49"/><label kind="guard" x="-240" y="-296">pmmode == 1</label><label kind="synchronisation" x="-240" y="-312">PMmodechange?</label><nail x="-104" y="-336"/></transition><transition><source ref="id53"/><target ref="id49"/><label kind="guard" x="-384" y="-304">pmmode == 1</label><label kind="synchronisation" x="-384" y="-320">PMmodechange?</label><nail x="-256" y="-344"/></transition><transition><source ref="id54"/><target ref="id49"/><label kind="guard" x="-456" y="-384">pmmode == 1</label><label kind="synchronisation" x="-456" y="-360">PMmodechange?</label></transition><transition><source ref="id49"/><target ref="id54"/><label kind="guard" x="-640" y="-472">pmmode == 0</label><label kind="synchronisation" x="-656" y="-448">PMmodechange?</label><nail x="-544" y="-320"/><nail x="-536" y="-512"/></transition><transition><source ref="id51"/><target ref="id50"/><label kind="synchronisation" x="104" y="-472">Asense?</label><nail x="32" y="-480"/><nail x="232" y="-480"/></transition><transition><source ref="id52"/><target ref="id50"/><label kind="synchronisation" x="200" y="-584">Apace!</label></transition><transition><source ref="id50"/><target ref="id54"/><label kind="assignment" x="-176" y="-800">clk_aa = 0</label><nail x="336" y="-560"/><nail x="336" y="-776"/><nail x="-544" y="-776"/><nail x="-544" y="-560"/></transition><transition><source ref="id53"/><target ref="id50"/><label kind="synchronisation" x="0" y="-760">Asense?</label><nail x="-168" y="-600"/><nail x="-120" y="-736"/><nail x="136" y="-736"/><nail x="184" y="-696"/></transition><transition><source ref="id51"/><target ref="id52"/><label kind="guard" x="-40" y="-640">clk_aa &gt;= (cur_lri - cur_avi)</label><nail x="32" y="-616"/><nail x="128" y="-616"/></transition><transition><source ref="id53"/><target ref="id51"/><label kind="synchronisation" x="-128" y="-600">Vsense?</label><label kind="assignment" x="-136" y="-584">clk_aa = 0</label><nail x="-120" y="-560"/></transition><transition><source ref="id53"/><target ref="id52"/><label kind="guard" x="-88" y="-696">clk_aa &gt;= cur_lri</label><nail x="-96" y="-672"/><nail x="128" y="-672"/></transition><transition><source ref="id54"/><target ref="id53"/><label kind="synchronisation" x="-352" y="-672">Vsense?</label><nail x="-384" y="-648"/><nail x="-256" y="-648"/></transition><transition><source ref="id54"/><target ref="id48"/><label kind="guard" x="-456" y="-472">clk_aa &gt;= (cur_avi + cur_avi_ext)</label><label kind="assignment" x="-560" y="-424">cur_avi_ext = (cur_avi_ext &gt;= Max_AVIExt) ? 0 : (((cur_avi_ext + AVIExt_Step) &gt;= Max_AVIExt) ? Max_AVIExt : (cur_avi_ext + AVIExt_Step))</label><nail x="-384" y="-480"/><nail x="-336" y="-480"/></transition></template><template><name>PM_Leds_Apace</name><location id="id55" x="112" y="0"><name x="102" y="-30">On</name><committed/></location><location id="id56" x="0" y="0"><name x="-10" y="-30">Off</name></location><init ref="id56"/><transition><source ref="id55"/><target ref="id56"/><nail x="56" y="48"/></transition><transition><source ref="id56"/><target ref="id55"/><label kind="synchronisation" x="24" y="-80">Apace?</label><nail x="56" y="-56"/></transition></template><template><name>PM_Leds_Asense</name><location id="id57" x="112" y="0"><name x="102" y="-30">On</name><committed/></location><location id="id58" x="0" y="0"><name x="-10" y="-30">Off</name></location><init ref="id58"/><transition><source ref="id57"/><target ref="id58"/><nail x="56" y="48"/></transition><transition><source ref="id58"/><target ref="id57"/><label kind="synchronisation" x="24" y="-80">Asense?</label><nail x="56" y="-56"/></transition></template><template><name>PM_Leds_Vpace</name><location id="id59" x="112" y="0"><name x="102" y="-30">On</name><committed/></location><location id="id60" x="0" y="0"><name x="-10" y="-30">Off</name></location><init ref="id60"/><transition><source ref="id59"/><target ref="id60"/><nail x="56" y="48"/></transition><transition><source ref="id60"/><target ref="id59"/><label kind="synchronisation" x="24" y="-80">Vpace?</label><nail x="56" y="-56"/></transition></template><template><name>PM_Leds_Vsense</name><location id="id61" x="112" y="0"><name x="102" y="-30">On</name><committed/></location><location id="id62" x="0" y="0"><name x="-10" y="-30">Off</name></location><init ref="id62"/><transition><source ref="id61"/><target ref="id62"/><nail x="56" y="48"/></transition><transition><source ref="id62"/><target ref="id61"/><label kind="synchronisation" x="24" y="-80">Vsense?</label><nail x="56" y="-56"/></transition></template><template><name>PM_DisplayAndAlarm</name><declaration>int aa_count = 0;
int aa_rate = 0;
clock t;</declaration><location id="id63" x="-976" y="-16"><name x="-986" y="-46">ShowRate</name><committed/></location><location id="id64" x="-368" y="-16"><name x="-378" y="-46">Incr</name><committed/></location><location id="id65" x="-496" y="-16"><name x="-472" y="-16">Init</name><label kind="invariant" x="-496" y="0">t &lt;= cur_msti</label></location><init ref="id65"/><transition><source ref="id63"/><target ref="id65"/><label kind="guard" x="-784" y="8">(aa_rate &gt; (60000 / cur_uri))</label><label kind="synchronisation" x="-784" y="-8">AlarmH!</label><nail x="-832" y="32"/><nail x="-584" y="32"/></transition><transition><source ref="id63"/><target ref="id65"/><label kind="guard" x="-912" y="-40">(aa_rate &gt;= (60000 / cur_lri)) &amp;&amp; (aa_rate &lt;= (60000 / cur_uri))</label><label kind="synchronisation" x="-784" y="-72">NoAlarm!</label><nail x="-792" y="-16"/></transition><transition><source ref="id63"/><target ref="id65"/><label kind="guard" x="-792" y="64">(aa_rate &lt; (60000 / cur_lri))</label><label kind="synchronisation" x="-744" y="80">AlarmL!</label><nail x="-928" y="96"/><nail x="-576" y="96"/></transition><transition><source ref="id63"/><target ref="id65"/></transition><transition><source ref="id65"/><target ref="id63"/><label kind="guard" x="-792" y="-168">t &gt;= cur_msti</label><label kind="assignment" x="-800" y="-144">aa_rate = ((aa_count * 60000) / cur_msti),
aa_count = 0,
t = 0</label><nail x="-576" y="-96"/><nail x="-736" y="-96"/><nail x="-832" y="-96"/></transition><transition><source ref="id64"/><target ref="id65"/><label kind="assignment" x="-464" y="136">aa_count = aa_count + 1</label><nail x="-256" y="-16"/><nail x="-256" y="128"/><nail x="-512" y="128"/><nail x="-512" y="0"/></transition><transition><source ref="id65"/><target ref="id64"/><label kind="synchronisation" x="-448" y="-112">Apace?</label><nail x="-464" y="-88"/><nail x="-392" y="-88"/></transition><transition><source ref="id65"/><target ref="id64"/><label kind="synchronisation" x="-448" y="64">Asense?</label><nail x="-488" y="-8"/><nail x="-464" y="56"/><nail x="-392" y="56"/></transition></template><template><name>Tester_HM_Random</name><location id="id66" x="-240" y="-48"></location><location id="id67" x="-400" y="-48"><committed/></location><init ref="id67"/><transition><source ref="id67"/><target ref="id66"/><label kind="synchronisation" x="-376" y="-80">testHM_random!</label></transition></template><template><name>Tester_HM_Keyboard</name><declaration>clock t;</declaration><location id="id68" x="-496" y="-80"></location><location id="id69" x="-144" y="-80"><committed/></location><location id="id70" x="-368" y="-80"><label kind="invariant" x="-400" y="-48">t &lt; 2000</label></location><init ref="id68"/><transition><source ref="id68"/><target ref="id70"/><label kind="synchronisation" x="-488" y="-112">testHM_manual!</label></transition><transition><source ref="id69"/><target ref="id70"/><label kind="select" x="-296" y="-240">i : tstkeyAV</label><label kind="synchronisation" x="-304" y="-216">testHM_gen[i]!</label><label kind="assignment" x="-316" y="-80">t = 0</label><nail x="-256" y="-184"/></transition><transition><source ref="id70"/><target ref="id69"/><nail x="-256" y="0"/></transition></template><template><name>Tester_HM_Predefined1</name><declaration>clock t;
</declaration><location id="id71" x="-496" y="-48"><name x="-528" y="-104">VAdelay</name><label kind="invariant" x="-528" y="-80">t &lt;= 1000</label></location><location id="id72" x="-624" y="-48"><name x="-648" y="-104">AVdelay</name><label kind="invariant" x="-648" y="-88">t &lt;= 35</label></location><location id="id73" x="-752" y="-48"><name x="-768" y="-96">GenA</name><committed/></location><location id="id74" x="-912" y="-48"><committed/></location><init ref="id74"/><transition><source ref="id71"/><target ref="id73"/><label kind="guard" x="-656" y="64">t &gt;= 1000</label><nail x="-496" y="32"/><nail x="-512" y="56"/><nail x="-736" y="56"/><nail x="-752" y="16"/></transition><transition><source ref="id72"/><target ref="id71"/><label kind="guard" x="-584" y="-32">t &gt;= 35</label><label kind="synchronisation" x="-592" y="-48">Vsignal!</label></transition><transition><source ref="id73"/><target ref="id72"/><label kind="synchronisation" x="-720" y="-40">Asignal!</label><label kind="assignment" x="-712" y="-24">t = 0</label></transition><transition><source ref="id74"/><target ref="id73"/><label kind="synchronisation" x="-872" y="-72">testHM_test!</label></transition></template><template><name>Tester_HM_Predefined2</name><declaration>clock t;
</declaration><location id="id75" x="-496" y="-48"><name x="-528" y="-104">VAdelay</name><label kind="invariant" x="-528" y="-80">t &lt;= 1000</label></location><location id="id76" x="-624" y="-48"><name x="-648" y="-104">AVdelay</name><label kind="invariant" x="-648" y="-88">t &lt;= 35</label></location><location id="id77" x="-752" y="-48"><name x="-768" y="-96">GenA</name><committed/></location><location id="id78" x="-912" y="-48"><committed/></location><init ref="id78"/><transition><source ref="id75"/><target ref="id77"/><label kind="guard" x="-656" y="64">t &gt;= 1000</label><nail x="-496" y="32"/><nail x="-512" y="56"/><nail x="-736" y="56"/><nail x="-752" y="16"/></transition><transition><source ref="id76"/><target ref="id75"/><label kind="guard" x="-584" y="-32">t &gt;= 135</label><label kind="synchronisation" x="-592" y="-48">Vsignal!</label></transition><transition><source ref="id77"/><target ref="id76"/><label kind="synchronisation" x="-720" y="-40">Asignal!</label><label kind="assignment" x="-712" y="-24">t = 0</label></transition><transition><source ref="id78"/><target ref="id77"/><label kind="synchronisation" x="-872" y="-72">testHM_test!</label></transition></template><template><name>Tester_HM_Predefined3</name><declaration>clock t;
</declaration><location id="id79" x="-496" y="-48"><name x="-528" y="-104">VAdelay</name><label kind="invariant" x="-528" y="-80">t &lt;= 1000</label></location><location id="id80" x="-624" y="-48"><name x="-648" y="-104">AVdelay</name><label kind="invariant" x="-648" y="-88">t &lt;= 35</label></location><location id="id81" x="-752" y="-48"><name x="-768" y="-96">GenA</name><committed/></location><location id="id82" x="-912" y="-48"><committed/></location><init ref="id82"/><transition><source ref="id79"/><target ref="id81"/><label kind="guard" x="-656" y="64">t &gt;= 2000</label><nail x="-496" y="32"/><nail x="-512" y="56"/><nail x="-736" y="56"/><nail x="-752" y="16"/></transition><transition><source ref="id80"/><target ref="id79"/><label kind="guard" x="-584" y="-32">t &gt;= 400</label><label kind="synchronisation" x="-592" y="-48">Vsignal!</label></transition><transition><source ref="id81"/><target ref="id80"/><label kind="synchronisation" x="-720" y="-40">Asignal!</label><label kind="assignment" x="-712" y="-24">t = 0</label></transition><transition><source ref="id82"/><target ref="id81"/><label kind="synchronisation" x="-872" y="-72">testHM_test!</label></transition></template><template><name>Tester_HM_HeIsDeadJim</name><location id="id83" x="0" y="0"><name x="-96" y="-8">DoNothing</name></location><init ref="id83"/><transition><source ref="id83"/><target ref="id83"/><nail x="0" y="56"/><nail x="64" y="48"/><nail x="56" y="-64"/><nail x="-8" y="-64"/></transition></template><template><name>Observer_PS</name><location id="id84" x="-160" y="0"><name x="-170" y="-30">Vsensed</name><committed/></location><location id="id85" x="160" y="-64"><name x="150" y="-94">Asensed</name><committed/></location><location id="id86" x="128" y="128"><name x="144" y="112">Vsignalled</name><committed/></location><location id="id87" x="-128" y="128"><name x="-208" y="120">Vpaced</name><committed/></location><location id="id88" x="-104" y="-160"><name x="-114" y="-190">Asignalled</name><committed/></location><location id="id89" x="72" y="-160"><name x="62" y="-190">Apaced</name><committed/></location><location id="id90" x="0" y="0"><name x="-10" y="-30">Observer</name></location><init ref="id90"/><transition><source ref="id84"/><target ref="id90"/></transition><transition><source ref="id90"/><target ref="id84"/><label kind="synchronisation" x="-144" y="8">Vsense?</label><nail x="-8" y="8"/><nail x="-160" y="56"/></transition><transition><source ref="id85"/><target ref="id90"/></transition><transition><source ref="id90"/><target ref="id85"/><label kind="synchronisation" x="152" y="-24">Asense?</label><nail x="32" y="0"/><nail x="128" y="0"/></transition><transition><source ref="id86"/><target ref="id90"/><nail x="96" y="32"/></transition><transition><source ref="id90"/><target ref="id86"/><label kind="synchronisation" x="4" y="49">Vsignal?</label></transition><transition><source ref="id87"/><target ref="id90"/><nail x="-32" y="88"/></transition><transition><source ref="id90"/><target ref="id87"/><label kind="synchronisation" x="-124" y="49">Vpace?</label></transition><transition><source ref="id88"/><target ref="id90"/><nail x="-104" y="-40"/></transition><transition><source ref="id90"/><target ref="id88"/><label kind="synchronisation" x="-124" y="-79">Asignal?</label></transition><transition><source ref="id89"/><target ref="id90"/><nail x="0" y="-128"/></transition><transition><source ref="id90"/><target ref="id89"/><label kind="synchronisation" x="4" y="-79">Apace?</label></transition></template><template><name>Observer_LRI</name><declaration>clock t;</declaration><location id="id91" x="48" y="16"><name x="38" y="-14">S3</name><committed/></location><location id="id92" x="-80" y="16"><name x="-90" y="-14">S2</name></location><location id="id93" x="-208" y="16"><name x="-218" y="-14">S1</name></location><init ref="id93"/><transition><source ref="id91"/><target ref="id92"/><label kind="assignment" x="-76" y="16">t = 0</label></transition><transition><source ref="id92"/><target ref="id91"/><label kind="synchronisation" x="-40" y="64">Apace?</label><nail x="-48" y="64"/><nail x="24" y="64"/></transition><transition><source ref="id92"/><target ref="id91"/><label kind="synchronisation" x="-48" y="-56">Asense?</label><nail x="-72" y="0"/><nail x="-48" y="-32"/><nail x="16" y="-32"/></transition><transition><source ref="id93"/><target ref="id92"/><label kind="synchronisation" x="-168" y="72">Apace?</label><label kind="assignment" x="-160" y="88">t = 0</label><nail x="-176" y="64"/><nail x="-112" y="64"/></transition><transition><source ref="id93"/><target ref="id92"/><label kind="synchronisation" x="-168" y="-48">Asense?</label><label kind="assignment" x="-160" y="-64">t = 0</label><nail x="-176" y="-32"/><nail x="-112" y="-32"/></transition></template><template><name>Observer_URI</name><declaration>clock t;
</declaration><location id="id94" x="-80" y="64"><name x="-64" y="48">S3</name><committed/></location><location id="id95" x="-112" y="-16"><name x="-96" y="-32">S2</name></location><location id="id96" x="-240" y="-16"><name x="-250" y="-46">S1</name></location><init ref="id96"/><transition><source ref="id94"/><target ref="id95"/><label kind="assignment" x="-128" y="64">t = 0</label><nail x="-136" y="64"/><nail x="-128" y="16"/></transition><transition><source ref="id95"/><target ref="id94"/><label kind="synchronisation" x="-72" y="16">Apace?</label><nail x="-80" y="24"/></transition><transition><source ref="id95"/><target ref="id95"/><label kind="synchronisation" x="-128" y="-136">Asense?</label><label kind="assignment" x="-120" y="-120">t = 0</label><nail x="-72" y="-72"/><nail x="-72" y="-96"/><nail x="-144" y="-96"/><nail x="-136" y="-64"/></transition><transition><source ref="id96"/><target ref="id95"/><label kind="synchronisation" x="-216" y="40">Apace?</label><label kind="assignment" x="-208" y="64">t = 0</label><nail x="-216" y="32"/><nail x="-160" y="32"/></transition><transition><source ref="id96"/><target ref="id95"/><label kind="synchronisation" x="-208" y="-104">Asense?</label><label kind="assignment" x="-200" y="-88">t = 0</label><nail x="-216" y="-64"/><nail x="-160" y="-64"/></transition></template><template><name>Observer_VRP</name><declaration>clock t;
</declaration><location id="id97" x="24" y="-16"><name x="40" y="-32">S3</name><committed/></location><location id="id98" x="-112" y="-16"><name x="-120" y="-56">S2</name></location><location id="id99" x="-240" y="-16"><name x="-250" y="-46">S1</name></location><init ref="id99"/><transition><source ref="id97"/><target ref="id98"/><label kind="assignment" x="-56" y="-8">t = 0</label></transition><transition><source ref="id98"/><target ref="id97"/><label kind="synchronisation" x="-72" y="40">Vpace?</label><nail x="-80" y="32"/><nail x="-8" y="32"/></transition><transition><source ref="id98"/><target ref="id97"/><label kind="synchronisation" x="-72" y="-88">Vsense?</label><nail x="-72" y="-64"/><nail x="-8" y="-64"/></transition><transition><source ref="id99"/><target ref="id98"/><label kind="synchronisation" x="-216" y="32">Vpace?</label><label kind="assignment" x="-208" y="48">t = 0</label><nail x="-216" y="32"/><nail x="-160" y="32"/></transition><transition><source ref="id99"/><target ref="id98"/><label kind="synchronisation" x="-208" y="-104">Vsense?</label><label kind="assignment" x="-200" y="-88">t = 0</label><nail x="-216" y="-64"/><nail x="-160" y="-64"/></transition></template><template><name>Observer_AV</name><declaration>clock t;
</declaration><location id="id100" x="80" y="200"><name x="88" y="176">BAD2</name><committed/></location><location id="id101" x="-16" y="152"><name x="-26" y="122">S35</name></location><location id="id102" x="376" y="32"><name x="366" y="2">BAD1</name><committed/></location><location id="id103" x="560" y="-16"><name x="550" y="-46">S7</name><committed/></location><location id="id104" x="440" y="-16"><name x="430" y="-46">S6</name></location><location id="id105" x="224" y="-16"><name x="216" y="-48">S5</name></location><location id="id106" x="-368" y="-16"><name x="-378" y="-46">S1</name></location><location id="id107" x="48" y="-16"><name x="40" y="-48">S4</name></location><location id="id108" x="-112" y="-16"><name x="-120" y="-56">S3</name></location><location id="id109" x="-240" y="-16"><name x="-250" y="-46">S2</name></location><init ref="id106"/><transition><source ref="id100"/><target ref="id105"/><nail x="224" y="200"/></transition><transition><source ref="id101"/><target ref="id100"/><label kind="synchronisation" x="-24" y="184">Apace?</label></transition><transition><source ref="id101"/><target ref="id105"/><label kind="synchronisation" x="80" y="160">Vsense?</label><nail x="224" y="152"/></transition><transition><source ref="id101"/><target ref="id105"/><label kind="synchronisation" x="80" y="112">Vpace?</label><nail x="-8" y="144"/><nail x="80" y="112"/><nail x="224" y="112"/></transition><transition><source ref="id105"/><target ref="id107"/><label kind="synchronisation" x="136" y="80">Apace?</label><label kind="assignment" x="144" y="96">t = 0</label><nail x="224" y="80"/><nail x="104" y="80"/></transition><transition><source ref="id105"/><target ref="id107"/><label kind="synchronisation" x="128" y="-168">Asense?</label><label kind="assignment" x="136" y="-152">t = 0</label><nail x="224" y="-120"/><nail x="104" y="-120"/></transition><transition><source ref="id102"/><target ref="id104"/><label kind="assignment" x="408" y="32">t = 0</label><nail x="424" y="32"/></transition><transition><source ref="id105"/><target ref="id102"/><label kind="synchronisation" x="240" y="40">Vpace?</label><nail x="248" y="32"/></transition><transition><source ref="id104"/><target ref="id103"/><label kind="synchronisation" x="472" y="32">Apace?</label><nail x="456" y="32"/><nail x="544" y="32"/></transition><transition><source ref="id104"/><target ref="id103"/><label kind="synchronisation" x="472" y="-88">Asense?</label><nail x="456" y="-64"/><nail x="536" y="-64"/></transition><transition><source ref="id105"/><target ref="id104"/><label kind="synchronisation" x="352" y="-104">Vsense?</label><label kind="assignment" x="360" y="-88">t = 0</label><nail x="232" y="-24"/><nail x="248" y="-64"/><nail x="424" y="-64"/></transition><transition><source ref="id103"/><target ref="id108"/><label kind="assignment" x="48" y="224">t = 0</label><nail x="560" y="96"/><nail x="464" y="224"/><nail x="200" y="224"/><nail x="-112" y="224"/><nail x="-112" y="96"/></transition><transition><source ref="id107"/><target ref="id105"/><label kind="synchronisation" x="136" y="40">Vpace?</label><nail x="120" y="32"/><nail x="200" y="32"/></transition><transition><source ref="id107"/><target ref="id105"/><label kind="synchronisation" x="128" y="-88">Vsense?</label><nail x="120" y="-64"/><nail x="192" y="-64"/></transition><transition><source ref="id106"/><target ref="id109"/><label kind="synchronisation" x="-328" y="32">Apace?</label><label kind="assignment" x="-328" y="-88">t = 0</label><nail x="-352" y="32"/><nail x="-256" y="32"/></transition><transition><source ref="id106"/><target ref="id109"/><label kind="synchronisation" x="-336" y="-112">Asense?</label><label kind="assignment" x="-320" y="48">t = 0</label><nail x="-352" y="-64"/><nail x="-264" y="-64"/></transition><transition><source ref="id108"/><target ref="id101"/><label kind="synchronisation" x="-72" y="72">Apace?</label><nail x="-80" y="32"/><nail x="-16" y="72"/></transition><transition><source ref="id108"/><target ref="id107"/><label kind="synchronisation" x="-72" y="-104">Asense?</label><nail x="-72" y="-64"/><nail x="-8" y="-64"/></transition><transition><source ref="id109"/><target ref="id108"/><label kind="synchronisation" x="-208" y="32">Vpace?</label><label kind="assignment" x="-200" y="48">t = 0</label><nail x="-216" y="32"/><nail x="-160" y="32"/></transition><transition><source ref="id109"/><target ref="id108"/><label kind="synchronisation" x="-208" y="-104">Vsense?</label><label kind="assignment" x="-200" y="-88">t = 0</label><nail x="-216" y="-64"/><nail x="-160" y="-64"/></transition></template><system>// List one or more processes to be composed into a system.
system 
	/* heart */
	  /* imp */ HM_Asignal, HM_Apace, HM_Vsignal, HM_Vpace, HM_ModeSwitch,
	  /* leds */ HM_Leds_Apace, HM_Leds_Asignal, HM_Leds_Vpace, HM_Leds_Vsignal, 
	/* pacemaker */
	  /* imp */ PM_Pacer_AA, PM_Sensor_A, PM_Sensor_V,
  	  /* leds */ PM_Leds_Apace, PM_Leds_Asense, PM_Leds_Vpace, PM_Leds_Vsense, PM_DisplayAndAlarm,
	/* testing */
//	  Tester, /* all */
//  	  Tester_HM_Random, // just heart - in random mode
//	  Tester_HM_HeIsDeadJim,	
//	  Tester_HM_Keyboard, // just heart - in keybord mode
	  Tester_HM_Predefined1, // just heart - in predefined test cases mode
	/* Observers */
	Observer_PS, Observer_LRI, Observer_URI, Observer_VRP, Observer_AV;</system></nta>